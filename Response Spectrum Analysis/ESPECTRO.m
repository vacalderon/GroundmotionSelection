clc; clear all; close all
EQ_List={'95.0_96.0_01.g3','210.0_217.0_01.g3','212.0_219.0_01.g3','214.0_223.0_01.g3','215.0_224.0_01.g3','230.0_233.0_01.g3','230.0_551.0_01.g3','230.0_236.0_01.g3','230.0_240.0_01.g3','230.0_244.0_01.g3','230.0_248.0_01.g3','231.0_234.0_01.g3','231.0_239.0_01.g3','231.0_243.0_01.g3','231.0_245.0_01.g3','231.0_250.0_01.g3','232.0_235.0_01.g3','285.0_296.0_01.g3','286.0_297.0_01.g3','289.0_300.0_01.g3','290.0_301.0_01.g3','291.0_302.0_01.g3','292.0_303.0_01.g3','368.0_383.0_01.g3','368.0_412.0_01.g3','543.0_548.0_01.g3','543.0_246.0_01.g3','544.0_549.0_01.g3','544.0_559.0_01.g3','544.0_562.0_01.g3','545.0_550.0_01.g3','545.0_560.0_01.g3','545.0_247.0_01.g3','546.0_552.0_01.g3','547.0_558.0_01.g3','547.0_561.0_01.g3','547.0_563.0_01.g3','589.0_707.0_01.g3','590.0_708.0_01.g3','592.0_3685.0_01.g3','593.0_1693.0_01.g3','594.0_3686.0_01.g3','595.0_3687.0_01.g3','598.0_3689.0_01.g3','599.0_3690.0_01.g3','602.0_3692.0_01.g3','608.0_3697.0_01.g3','611.0_3698.0_01.g3','613.0_3700.0_01.g3','614.0_3701.0_01.g3','615.0_709.0_01.g3','616.0_3702.0_01.g3','620.0_3704.0_01.g3','622.0_3707.0_01.g3','625.0_710.0_01.g3','626.0_711.0_01.g3','627.0_712.0_01.g3','627.0_1706.0_01.g3','629.0_1707.0_01.g3','632.0_3709.0_01.g3','633.0_3710.0_01.g3','634.0_3711.0_01.g3','635.0_713.0_01.g3','635.0_1710.0_01.g3','637.0_3713.0_01.g3','638.0_3714.0_01.g3','639.0_714.0_01.g3','640.0_3715.0_01.g3','641.0_3716.0_01.g3','642.0_3717.0_01.g3','645.0_3724.0_01.g3','649.0_3720.0_01.g3','650.0_3721.0_01.g3','652.0_3722.0_01.g3','661.0_3727.0_01.g3','663.0_715.0_01.g3','665.0_1665.0_01.g3','665.0_1670.0_01.g3','665.0_1721.0_01.g3','667.0_1722.0_01.g3','671.0_1671.0_01.g3','671.0_3765.0_01.g3','671.0_1723.0_01.g3','672.0_3731.0_01.g3','683.0_3733.0_01.g3','690.0_3734.0_01.g3','691.0_716.0_01.g3','692.0_3735.0_01.g3','694.0_3736.0_01.g3','695.0_3737.0_01.g3','697.0_3739.0_01.g3','698.0_3767.0_01.g3','699.0_1738.0_01.g3','700.0_717.0_01.g3','705.0_3743.0_01.g3','718.0_729.0_01.g3','942.0_707.0_01.g3','948.0_3685.0_01.g3','949.0_1693.0_01.g3','950.0_3686.0_01.g3','951.0_3687.0_01.g3','954.0_3689.0_01.g3','956.0_3691.0_01.g3','962.0_3697.0_01.g3','963.0_1676.0_01.g3','963.0_1683.0_01.g3','964.0_3698.0_01.g3','966.0_3700.0_01.g3','967.0_3701.0_01.g3','968.0_709.0_01.g3','970.0_3702.0_01.g3','974.0_3704.0_01.g3','976.0_3707.0_01.g3','981.0_710.0_01.g3','982.0_1685.0_01.g3','982.0_1703.0_01.g3','983.0_1686.0_01.g3','983.0_1704.0_01.g3','984.0_711.0_01.g3','985.0_712.0_01.g3','985.0_1706.0_01.g3','988.0_1707.0_01.g3','990.0_1708.0_01.g3','991.0_3709.0_01.g3','992.0_3710.0_01.g3','993.0_3711.0_01.g3','995.0_713.0_01.g3','995.0_1710.0_01.g3','997.0_3713.0_01.g3','998.0_3714.0_01.g3','999.0_714.0_01.g3','1001.0_3715.0_01.g3','1003.0_3716.0_01.g3','1004.0_3771.0_01.g3','1006.0_3764.0_01.g3','1006.0_3769.0_01.g3','1017.0_3720.0_01.g3','1018.0_3721.0_01.g3','1024.0_3722.0_01.g3','1039.0_1681.0_01.g3','1041.0_715.0_01.g3','1044.0_1665.0_01.g3','1044.0_1670.0_01.g3','1044.0_1721.0_01.g3','1048.0_1722.0_01.g3','1052.0_1671.0_01.g3','1052.0_3765.0_01.g3','1052.0_1723.0_01.g3','1070.0_3734.0_01.g3','1072.0_716.0_01.g3','1076.0_3735.0_01.g3','1077.0_1730.0_01.g3','1082.0_3737.0_01.g3','1083.0_3739.0_01.g3','1086.0_3767.0_01.g3','1087.0_1674.0_01.g3','1087.0_1739.0_01.g3','1094.0_3743.0_01.g3','1186.0_3258.0_01.g3','1187.0_2452.0_01.g3','1187.0_2694.0_01.g3','1193.0_2457.0_01.g3','1193.0_2699.0_01.g3','1193.0_2942.0_01.g3','1193.0_3264.0_01.g3','1194.0_2160.0_01.g3','1194.0_2458.0_01.g3','1194.0_2700.0_01.g3','1194.0_2943.0_01.g3','1194.0_3265.0_01.g3','1195.0_2459.0_01.g3','1195.0_3266.0_01.g3','1197.0_2163.0_01.g3','1197.0_2461.0_01.g3','1197.0_2703.0_01.g3','1197.0_3268.0_01.g3','1198.0_2164.0_01.g3','1198.0_2462.0_01.g3','1198.0_2704.0_01.g3','1198.0_2946.0_01.g3','1198.0_3269.0_01.g3','1201.0_2465.0_01.g3','1201.0_2708.0_01.g3','1201.0_3273.0_01.g3','1202.0_2466.0_01.g3','1202.0_2709.0_01.g3','1202.0_2950.0_01.g3','1202.0_3274.0_01.g3','1203.0_2169.0_01.g3','1203.0_2467.0_01.g3','1203.0_2710.0_01.g3','1203.0_3275.0_01.g3','1204.0_2711.0_01.g3','1205.0_2469.0_01.g3','1205.0_3278.0_01.g3','1206.0_2470.0_01.g3','1206.0_2712.0_01.g3','1206.0_3279.0_01.g3','1208.0_2472.0_01.g3','1208.0_2714.0_01.g3','1208.0_3281.0_01.g3','1209.0_2473.0_01.g3','1209.0_2715.0_01.g3','1209.0_3282.0_01.g3','1211.0_2717.0_01.g3','1227.0_2490.0_01.g3','1227.0_2734.0_01.g3','1227.0_3300.0_01.g3','1231.0_2195.0_01.g3','1231.0_2495.0_01.g3','1231.0_2739.0_01.g3','1234.0_2498.0_01.g3','1234.0_2742.0_01.g3','1234.0_3307.0_01.g3','1235.0_2743.0_01.g3','1235.0_3308.0_01.g3','1236.0_2500.0_01.g3','1236.0_2744.0_01.g3','1238.0_2746.0_01.g3','1238.0_3311.0_01.g3','1240.0_3313.0_01.g3','1244.0_2507.0_01.g3','1244.0_2752.0_01.g3','1244.0_3317.0_01.g3','1245.0_2753.0_01.g3','1246.0_2208.0_01.g3','1246.0_2509.0_01.g3','1246.0_2754.0_01.g3','1258.0_2216.0_01.g3','1258.0_2997.0_01.g3','1261.0_2999.0_01.g3','1262.0_3000.0_01.g3','1262.0_3328.0_01.g3','1264.0_3002.0_01.g3','1265.0_3003.0_01.g3','1265.0_3330.0_01.g3','1268.0_3006.0_01.g3','1269.0_3007.0_01.g3','1269.0_3333.0_01.g3','1270.0_3008.0_01.g3','1277.0_2235.0_01.g3','1277.0_3015.0_01.g3','1277.0_3341.0_01.g3','1278.0_3016.0_01.g3','1279.0_3017.0_01.g3','1280.0_3018.0_01.g3','1281.0_2239.0_01.g3','1281.0_3019.0_01.g3','1282.0_3020.0_01.g3','1282.0_3345.0_01.g3','1283.0_3021.0_01.g3','1283.0_3346.0_01.g3','1284.0_3022.0_01.g3','1285.0_3023.0_01.g3','1286.0_3024.0_01.g3','1286.0_3349.0_01.g3','1287.0_3025.0_01.g3','1288.0_3026.0_01.g3','1289.0_3027.0_01.g3','1289.0_3351.0_01.g3','1290.0_3028.0_01.g3','1294.0_3032.0_01.g3','1295.0_2253.0_01.g3','1295.0_3033.0_01.g3','1296.0_3034.0_01.g3','1297.0_2255.0_01.g3','1297.0_3035.0_01.g3','1297.0_3357.0_01.g3','1300.0_3358.0_01.g3','1301.0_3036.0_01.g3','1302.0_2258.0_01.g3','1303.0_2259.0_01.g3','1303.0_3038.0_01.g3','1304.0_2260.0_01.g3','1304.0_3039.0_01.g3','1304.0_3362.0_01.g3','1350.0_2299.0_01.g3','1380.0_2821.0_01.g3','1380.0_3404.0_01.g3','1482.0_2364.0_01.g3','1482.0_3450.0_01.g3','1483.0_3451.0_01.g3','1488.0_3174.0_01.g3','1488.0_3455.0_01.g3','1489.0_3175.0_01.g3','1490.0_3176.0_01.g3','1491.0_3177.0_01.g3','1491.0_3458.0_01.g3','1492.0_2372.0_01.g3','1492.0_3178.0_01.g3','1492.0_3459.0_01.g3','1493.0_3179.0_01.g3','1494.0_3180.0_01.g3','1495.0_2375.0_01.g3','1495.0_3181.0_01.g3','1496.0_3182.0_01.g3','1496.0_3461.0_01.g3','1497.0_3183.0_01.g3','1498.0_2378.0_01.g3','1498.0_2613.0_01.g3','1498.0_3463.0_01.g3','1499.0_3185.0_01.g3','1500.0_2615.0_01.g3','1500.0_3186.0_01.g3','1500.0_3465.0_01.g3','1501.0_2381.0_01.g3','1501.0_2616.0_01.g3','1503.0_2382.0_01.g3','1503.0_2618.0_01.g3','1503.0_3467.0_01.g3','1504.0_2383.0_01.g3','1504.0_2619.0_01.g3','1504.0_3188.0_01.g3','1504.0_3468.0_01.g3','1505.0_3189.0_01.g3','1505.0_3469.0_01.g3','1506.0_2621.0_01.g3','1506.0_3190.0_01.g3','1507.0_2385.0_01.g3','1507.0_2622.0_01.g3','1508.0_2623.0_01.g3','1508.0_3470.0_01.g3','1509.0_2387.0_01.g3','1509.0_2625.0_01.g3','1510.0_2388.0_01.g3','1510.0_2626.0_01.g3','1510.0_3471.0_01.g3','1511.0_2389.0_01.g3','1511.0_2627.0_01.g3','1511.0_3472.0_01.g3','1512.0_2390.0_01.g3','1512.0_2628.0_01.g3','1512.0_3473.0_01.g3','1513.0_2391.0_01.g3','1513.0_2629.0_01.g3','1513.0_3474.0_01.g3','1515.0_2631.0_01.g3','1515.0_3192.0_01.g3','1515.0_3477.0_01.g3','1517.0_2395.0_01.g3','1517.0_2632.0_01.g3','1517.0_2871.0_01.g3','1520.0_2398.0_01.g3','1521.0_2399.0_01.g3','1521.0_2635.0_01.g3','1528.0_3201.0_01.g3','1529.0_3202.0_01.g3','1529.0_3489.0_01.g3','1530.0_3203.0_01.g3','1530.0_3490.0_01.g3','1531.0_3204.0_01.g3','1532.0_3205.0_01.g3','1532.0_3492.0_01.g3','1533.0_2407.0_01.g3','1533.0_2644.0_01.g3','1533.0_3206.0_01.g3','1534.0_2645.0_01.g3','1534.0_3207.0_01.g3','1534.0_3493.0_01.g3','1535.0_2409.0_01.g3','1535.0_2646.0_01.g3','1535.0_3208.0_01.g3','1535.0_3495.0_01.g3','1536.0_2410.0_01.g3','1536.0_2884.0_01.g3','1536.0_3496.0_01.g3','1538.0_3497.0_01.g3','1539.0_3498.0_01.g3','1540.0_2649.0_01.g3','1540.0_3211.0_01.g3','1540.0_3499.0_01.g3','1541.0_2650.0_01.g3','1541.0_2888.0_01.g3','1542.0_2416.0_01.g3','1542.0_2651.0_01.g3','1543.0_2652.0_01.g3','1543.0_3500.0_01.g3','1545.0_2654.0_01.g3','1545.0_3502.0_01.g3','1546.0_2420.0_01.g3','1546.0_2655.0_01.g3','1546.0_2893.0_01.g3','1546.0_3503.0_01.g3','1547.0_2656.0_01.g3','1547.0_3215.0_01.g3','1547.0_3504.0_01.g3','1549.0_2423.0_01.g3','1549.0_2658.0_01.g3','1549.0_3217.0_01.g3','1549.0_3507.0_01.g3','1550.0_3219.0_01.g3','1551.0_2661.0_01.g3','1551.0_2897.0_01.g3','1551.0_3220.0_01.g3','1551.0_3509.0_01.g3','1552.0_3511.0_01.g3','1553.0_2663.0_01.g3','1553.0_2899.0_01.g3','1553.0_3222.0_01.g3','1553.0_3512.0_01.g3','1554.0_2900.0_01.g3','1554.0_3513.0_01.g3','1581.0_3245.0_01.g3','1586.0_2928.0_01.g3','1605.0_1158.0_01.g3'};

dt_list=[0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.002,0.002,0.002,0.002,0.002,0.002,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.02,0.005,0.005,0.005,0.005,0.005,0.02,0.02,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.01,0.02,0.01,0.005,0.005,0.005,0.005,0.02,0.005,0.005,0.005,0.005,0.005,0.005,0.02,0.02,0.005,0.005,0.005,0.02,0.005,0.02,0.02,0.02,0.01,0.02,0.02,0.02,0.005,0.005,0.005,0.02,0.005,0.005,0.01,0.02,0.02,0.005,0.004,0.004,0.004,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.004,0.004,0.004,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.004,0.004,0.004,0.004,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.004,0.004,0.004,0.005,0.005,0.005,0.005,0.004,0.004,0.004,0.004,0.004,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.004,0.004,0.004,0.004,0.004,0.004,0.004,0.004,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.004,0.004,0.004,0.004,0.004,0.004,0.004,0.004,0.004,0.004,0.004,0.004,0.005,0.004,0.005];


% ======================== Program ESPECTRO.m =========================== %

%    Program for the analysis of strong motion data, it calculates:

%    - velocity and displacement time histories by trapezoidal integration

%    - Fourier spectrum via FFT

%    - Displacement, pseudo-velocity and pseudo-acceleration response
%      spectrum for any values of damping ratio. Equation of motion is
%      solved using the duhamel integral.

%    - Husid plot, significant duration and bracketed duration

%               LUIS A. MONTEJO (lumontv@yahoo.com.ar)

%         uptades available at www.geocities.com/lumontv/eng

%      DEPARTMENT OF CIVIL, CONSTRUCTION AND ENVIROMENTAL ENGINEERING

%                  NORTH CAROLINA STATE UNIVERSITY

%                       last updated: 02/20/2007

% ======================================================================= %

neq=length(EQ_List);

for i=1:neq
    % Input data:
    clearvars -except EQ_List neq dt_list i
    name =char(EQ_List(i)) ;                                % identifies actual work, the output file will be name.xls

    dt   = dt_list(i);                                  % time step of accelerogram [sec]
    zi   = [0.05];                    % vector with the damping ratios
    nom  = char(EQ_List(i));          % name of earthquake file
    go   = 1;                         % acceleration of gravity in the same untis that
                                      % your eq. record is, ig your record is in g's
                                      % then input 1

    Tmax = 10;			              % final period for spectra [sec]
    Ti   = 0.001;                     % initial period for spectra [sec]
    dT   = 0.1;                       % interval for natural periods


    % ==============================================================
    % ============================================ END OF INPUT DATA
































    % ========================================================================
     % ========================================================================



    nzi  = length(zi);                      % number of damping ratios
    g    = 981;                             % acceleration of gravity [cm/s^2]
    addpath('C:\ConditionDependentPBEE\GroundMotion_Squences_Records');            % directory with the accelerograms
    terr = load ([nom]);             % read earthquake data file load ([nom,'.g3']
    [nr,nc]  = size(terr); 	                % columns and rows of data file
    nt       = nr*nc;		     		    % original number of data points
    xg(1:nt) = (g/go)*terr';                % copy accelerogram in a vector
    np = length(xg);
    Tu   = (np-1) * dt;	    	        % final time of accelerogram
    t    = 0: dt: Tu;				        % vector with sampled times

    %==========================================================================
    %========== velocities and displacements via trapezoidal integration:

    vel   = dt*cumtrapz(xg);
    despl = dt*cumtrapz(vel); 

%     figure;subplot(3,1,1); plot( t,xg/g, 'b','LineWidth',1); 
%     grid on; axis tight; 
%     title(['acceleration, velocity and displacement time histories for ',nom],'FontSize',16);
%     ylabel('accel. [%g]','FontSize',16);
% 
%     subplot(3,1,2); plot( t,vel,'b', 'LineWidth',1); grid on;
%     axis tight; ylabel('vel. [cm/s]','FontSize',16);
% 
%     subplot(3,1,3); plot( t,despl,'b' ,'LineWidth',1); grid on;
%     axis tight; xlabel('time [s]','FontSize',16); ylabel('displ. [cm]','FontSize',16);

    %==========================================================================
    %========== response spectrum via Duhamel integral:

    T    = Ti: dT: Tmax;     	                  % vector with natural periods

    nper   = length(T);						          % number of natural periods
    SD     = zeros(nzi,nper);				          % rel. displac. spectrum
    PSV    = zeros(nzi,nper);				          % pseudo-vel. spectrum
    PSA    = zeros(nzi,nper);				          % pseudo-acc. spectrum

    for k = 1 : nzi
        for j = 1 : nper
            wn       = 2*pi/T(j);
            ub       = duhamel(wn,zi(k),1,dt,nt,0,0,-xg);
            SD(k,j)    = max( abs(ub) );
        end
        PSV(k,:) = (2*pi./T) .* SD(k,:);                   % pseudo-vel. spectrum
        PSA(k,:) = (2*pi./T).^2 .* SD(k,:);  	          % pseudo-accel. spectrum
    end

%     figure; plot(T,SD); grid on; axis tight;title(['Displacement Spectrum of ',nom],'FontSize',16);
%     ylabel('displacement [cm]','FontSize',16); xlabel('period [s]','FontSize',16);
% 
%     figure; plot(T,PSV); grid on; axis tight;title(['Pseudo-Velocity Spectrum of ',nom],'FontSize',16);
%     ylabel('PSV [cm/s]','FontSize',16); xlabel('period [s]','FontSize',16);
% 
%     figure; plot(T,PSA./g); grid on; axis tight;title(['Pseudo-Acceleration Spectrum of ',nom],'FontSize',16);
%     ylabel('PSA [g]','FontSize',16); xlabel('period [s]','FontSize',16);


    %==========================================================================
    %============= Husid plot, significant duration:

    Ia = zeros(1,nt);
    for n = 1 : nt
        Ia(n) = pi/(2*g)*dt*trapz( xg(1:n).^2 );
    end
    AI  = Ia(np);
    Ia  = Ia/Ia(np);
    x1  = 0.05*ones(1,np);
    x2  = 0.95*ones(1,np);
    [xmin,imin] = min( abs(Ia-0.05) );
    [xmax,imax] = min( abs(Ia-0.95) );
    dur = t(imax) - t(imin);

%     figure;  plot( t,Ia, t,x1, t,x2, t(imin),Ia(imin),'o', t(imax),Ia(imax),'o','LineWidth',2,...
%                     'MarkerEdgeColor','m',...
%                     'MarkerSize',8);
%     grid on; axis tight; title(['Husid plot of ',nom],'FontSize',16);
%     xlabel('Time [s]','FontSize',16); ylabel('Normalized intensity','FontSize',16);
%     text(2,0.07,'5%','FontSize',16); text(2,0.97,'95%','FontSize',16); 
%     text(Tu/2.7,0.55,['significant duration: ',num2str(dur),' s'],'FontSize',16)

%     pc=find(abs(xg/g)>0.05);
%     last=length(pc);
%     tc1=t(pc(1)); acc1 = xg(pc(1)); 
%     tc2=t(pc(last)); acc2 = xg(pc(last));
%     duration=tc2-tc1;
% 
%     cs=ones(1,np);
%     cs=0.05.*cs;
% 
%     figure;plot( t,abs(xg/g), 'b',t,cs,'r',tc1,abs(acc1)/g,'o',tc2,abs(acc2)/g,'o','LineWidth',1,...
%                     'MarkerEdgeColor','r',...
%                     'MarkerSize',8); 
%     grid on; axis tight; 
%     title(['bracketed duration of ',nom],'FontSize',16);
%     ylabel('abs(accel.) [%g]','FontSize',16);xlabel('Time [s]','FontSize',16);
%     text(Tu/2.5,0.95*max(abs(xg))/g,['bracketed duration: ',num2str(duration),' s'],'FontSize',16)

    %==========================================================================
    %============= Fourier spectrum via FFT:


    wny = pi/dt;					          % Nyquist frequency: rad/sec
    dw  = 2*pi / Tu;                          % frequency interval: rad/sec
    w   = 0.00001: dw: nt/2*dw;               % vector with frequencies in rad/sec
    f   = w/(2*pi);                           % vector with frequencies in cycles/sec                  
    Amp = dt * abs( fft(xg) );                % calculate the FT of the earthquake
    Amp = Amp(1:length(f));

%     figure; plot( f, Amp ); grid on; 
%     axis tight; title(['Fourier spectrum of ',nom],'FontSize',16)
%     xlabel('Frequency f [Hz]','FontSize',16); ylabel('Amplitude','FontSize',16);

    % =========================================================================
    % =========================================================================


    THS = [t' xg'./g vel' despl' Ia'];
    PGA = max(abs(xg./g));
    PGV = max(abs(vel));
    PGD = max(abs(despl));


    fid = fopen([name,'.csv'],'w');

    fprintf(fid, ' \n');
    fprintf(fid, 'PGA:,  %4.2f g\n',PGA);
    fprintf(fid, 'PGV:,  %4.2f cm/s\n',PGV);
    fprintf(fid, 'PGD:,  %4.2f cm\n',PGD);
    fprintf(fid, 'Arias Intensity:,  %5.2f cm/s\n',AI);
    fprintf(fid, 'Significant duration:,  %5.2f s\n',dur);
%     fprintf(fid, 'Bracketed  duration:,  %5.2f s\n',duration);
    fprintf(fid, ' \n');
    for k =1:nzi
        res = [T'  SD(k,:)'  PSV(k,:)'  PSA(k,:)'/g];
        fprintf(fid, ' \n');
        fprintf(fid, 'Damping ratio for spectra:  %3.2f\n\n',zi(k));
        fprintf(fid, ' \n');
        fprintf(fid, 'period [s]\tSD. [cm]\tPSV [cm/s]\tPSA [g]\n'); 
        fprintf(fid, '%3.4f\t, %4.3f\t, %4.3f\t, %4.3f\n',res');
        fprintf(fid, ' \n');

    end
    fprintf(fid, 'acceleration, velocity, displacement and normalized Arias intensity time histories:\n');
    fprintf(fid, ' \n');
    fprintf(fid, 'time [s]\taccel. [g]\tvel. [cm/s]\tdispl. [cm]\tAI\n'); 
    fprintf(fid, '%3.3f\t%1.7f\t%4.7f\t%4.7f\t%1.7f\n',THS');
    fprintf(fid, ' \n');
    fclose(fid);
end